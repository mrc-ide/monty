<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with samples • monty</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Working with samples">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">monty</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/monty.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/dsl.html">Probabilistic DSL</a></li>
    <li><a class="dropdown-item" href="../articles/samples.html">Working with samples</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/dsl-errors.html">DSL parse errors</a></li>
    <li><a class="dropdown-item" href="../articles/samplers.html">Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from mcstate</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending</h6></li>
    <li><a class="dropdown-item" href="../articles/writing-samplers.html">Writing samplers</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/monty/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Working with samples</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/monty/blob/main/vignettes/samples.Rmd" class="external-link"><code>vignettes/samples.Rmd</code></a></small>
      <div class="d-none name"><code>samples.Rmd</code></div>
    </div>

    
    
<p>This vignette outlines some ways of working with samples generated
from running an MCMC with <code>monty_sample</code>. We’ll flesh this
out as we develop nicer ways of working with samples, and mostly exists
so that we can point to it from other documentation, including from
other packages (e.g., from <a href="https://mrc-ide.github.io/odin2" class="external-link"><code>odin2</code></a>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mrc-ide.github.io/monty">monty</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="the-structure-of-monty-samples">The structure of monty samples<a class="anchor" aria-label="anchor" href="#the-structure-of-monty-samples"></a>
</h2>
<p>All samplers and runners produce samples with the same basic
structure. This structure is documented (here) so you are free to use
this structure if you want to just dive in and manipulate things. Please
treat output as read-only; extract data all you want, but make a copy
and don’t change any value within the samples structure if you are going
to pass it back into a <code>monty</code> function, as we assume that
they have not been modified.</p>
<p>Below, <code>samples</code> is a poorly mixed result of samples with
2 parameters, 2000 samples, and 4 chains. It was the result of running
<code><a href="../reference/monty_sample.html">monty_sample()</a></code> on the banana model from
<code><a href="../articles/samplers.html">vignette("samplers")</a></code>, and has class
<code>monty_samples</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">&lt;monty_samples: 2 parameters x 2000 samples x 4 chains&gt;</span> <span style="color: #00BBBB;">─────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Parameters: 'alpha' and 'beta'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Conversion to other types is possible:</span></span>
<span><span class="co">#&gt; → <span style="color: #BBBB00;">!</span> posterior::as_draws_array() <span style="color: #555555;">[package installed, but not loaded]</span></span></span>
<span><span class="co">#&gt; → <span style="color: #BBBB00;">!</span> posterior::as_draws_df() <span style="color: #555555;">[package installed, but not loaded]</span></span></span>
<span><span class="co">#&gt; → <span style="color: #BBBB00;">!</span> coda::as.mcmc.list() <span style="color: #555555;">[package installed, but not loaded]</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See `?monty_sample()` and `vignette("samples")` for more information</span></span></code></pre></div>
<p>Each <code>monty_samples</code> object contains an element
<code>pars</code> which contains sampled parameters</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">$</span><span class="va">pars</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]    2 2000    4</span></span></code></pre></div>
<div class="section level3">
<h3 id="conversion-to-posteriors-draw-objects">Conversion to <code>posterior</code>’s <code>draw</code>
objects<a class="anchor" aria-label="anchor" href="#conversion-to-posteriors-draw-objects"></a>
</h3>
<p>We implement methods for <code><a href="https://mc-stan.org/posterior/reference/draws_array.html" class="external-link">posterior::as_draws_array</a></code> and
<code><a href="https://mc-stan.org/posterior/reference/draws_df.html" class="external-link">posterior::as_draws_df</a></code>, which you can use to convert to
formats that you might be familiar with from use with other statistical
packages. This only preserves the parameters (<code>$pars</code>) from
above.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples_df</span> <span class="op">&lt;-</span> <span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_df.html" class="external-link">as_draws_df</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span></code></pre></div>
<p>With this, you can access summary methods already implemented
elsewhere:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarise_draws</a></span><span class="op">(</span><span class="va">samples_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 10</span></span></span>
<span><span class="co">#&gt;   variable  mean median    sd   mad     q5   q95  rhat ess_bulk ess_tail</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> alpha    2.27   0.645  3.06  1.39 -<span style="color: #BB0000;">0.612</span>  7.73  1.85     5.79     43.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> beta     0.608  0.364  1.39  1.02 -<span style="color: #BB0000;">2.05</span>   2.78  2.10     5.32     11.7</span></span></code></pre></div>
<p>With these objects you should be able to use any of the plotting
functions in <a href="https://mc-stan.org/bayesplot" class="external-link"><code>bayesplot</code></a>, for
example, <a href="https://mc-stan.org/bayesplot/articles/visual-mcmc-diagnostics.html" class="external-link">MCMC
visual diagnostics</a>, without much trouble.</p>
<p>We also support conversion to <code>draws_array</code>; let us know
if you need the other conversion functions (<code>as_draws_list</code>,
<code>as_draws_rvars</code>, <code>as_draws_matrix</code>).</p>
</div>
<div class="section level3">
<h3 id="conversion-to-codas-mcmc-list-objects">Conversion to <code>coda</code>’s <code>mcmc.list</code>
objects<a class="anchor" aria-label="anchor" href="#conversion-to-codas-mcmc-list-objects"></a>
</h3>
<p>The <code>coda</code> package has utilities for working with MCMC,
and many other packages are compatible with its <code>mcmc.list</code>
object type (e.g., the <a href="https://cran.r-project.org/package=ggmcmc" class="external-link"><code>ggmcmc</code></a>
package). We provide a method for <code>coda</code>’s
<code>as.mcmc.list</code>, if that package is available:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples_coda</span> <span class="op">&lt;-</span> <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">as.mcmc.list</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/effectiveSize.html" class="external-link">effectiveSize</a></span><span class="op">(</span><span class="va">samples_coda</span><span class="op">)</span></span>
<span><span class="co">#&gt;    alpha     beta </span></span>
<span><span class="co">#&gt; 39.92519 68.47306</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Ed Knock, Marc Baguelin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
