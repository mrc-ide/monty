<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Probabilistic DSL • monty</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Probabilistic DSL">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">monty</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/monty.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/dsl.html">Probabilistic DSL</a></li>
    <li><a class="dropdown-item" href="../articles/samples.html">Working with samples</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/dsl-errors.html">DSL parse errors</a></li>
    <li><a class="dropdown-item" href="../articles/samplers.html">Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from mcstate</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending</h6></li>
    <li><a class="dropdown-item" href="../articles/writing-samplers.html">Writing samplers</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/monty/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Probabilistic DSL</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/monty/blob/main/vignettes/dsl.Rmd" class="external-link"><code>vignettes/dsl.Rmd</code></a></small>
      <div class="d-none name"><code>dsl.Rmd</code></div>
    </div>

    
    
<p><code>monty</code> includes a simple probabilistic domain-specific
language (DSL) that is inspired by <code>stan</code> and <a href="https://xcelab.net/rm/" class="external-link">Statistical Rethinking</a>. It is designed
to make some tasks a bit easier, particularly when defining priors for
your model. We expect that this DSL is not sufficiently advanced to
represent most interesting models but it may get more clever and
flexible in the future. In particular we do not expect the DSL to be
useful in writing likelihood functions for comparison to data; we expect
that if your model is simple enough for this you would be better off
using <code>stan</code> or some similarly flexible system.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mrc-ide.github.io/monty">monty</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="some-simple-examples">Some simple examples<a class="anchor" aria-label="anchor" href="#some-simple-examples"></a>
</h2>
<p>In chapter 4 of Statistical Rethinking, we build a regression model
of height with parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>.
We can define the model for the prior probability of this model in monty
by running</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monty_dsl.html">monty_dsl</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">alpha</span> <span class="op">~</span> <span class="fu">Normal</span><span class="op">(</span><span class="fl">178</span>, <span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="va">beta</span> <span class="op">~</span> <span class="fu">Normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="va">sigma</span> <span class="op">~</span> <span class="fu">Uniform</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>This will define a new <code><a href="../reference/monty_model.html">monty_model()</a></code> object that
represents the prior, but with all the bits that we might need depending
on how we want to use it:</p>
<p>We have model parameters</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span><span class="op">$</span><span class="va">parameters</span></span>
<span><span class="co">#&gt; [1] "alpha" "beta"  "sigma"</span></span></code></pre></div>
<p>These are defined in the order that they appear in your definition
(so <code>alpha</code> is first and <code>sigma</code> is last)</p>
<p>We can compute the domain for your model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span><span class="op">$</span><span class="va">domain</span></span>
<span><span class="co">#&gt;       [,1] [,2]</span></span>
<span><span class="co">#&gt; alpha -Inf  Inf</span></span>
<span><span class="co">#&gt; beta  -Inf  Inf</span></span>
<span><span class="co">#&gt; sigma    0   50</span></span></code></pre></div>
<p>We can draw samples from the model if we provide a
<code>monty_rng</code> object</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rng</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monty_rng_create.html">monty_rng_create</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monty_model_direct_sample.html">monty_model_direct_sample</a></span><span class="op">(</span><span class="va">prior</span>, <span class="va">rng</span><span class="op">)</span></span>
<span><span class="va">theta</span></span>
<span><span class="co">#&gt; [1] 167.700794  -5.085348   8.899977</span></span></code></pre></div>
<p>We can compute the (log) density at a point in parameter space</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/monty_model_density.html">monty_model_density</a></span><span class="op">(</span><span class="va">prior</span>, <span class="va">theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -11.31011</span></span></code></pre></div>
<p>The computed properties for the model are:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span><span class="op">$</span><span class="va">properties</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">&lt;monty_model_properties&gt;</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> has_gradient: `TRUE`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> has_direct_sample: `TRUE`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> is_stochastic: `FALSE`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> has_parameter_groups: `FALSE`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> has_observer: `FALSE`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> allow_multiple_parameters: `TRUE`</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculations-in-the-dsl">Calculations in the DSL<a class="anchor" aria-label="anchor" href="#calculations-in-the-dsl"></a>
</h2>
<p>Sometimes it will be useful to perform calculations in the code; you
can do this with assignments. Most trivially, giving names to numbers
may help make code more understandable:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monty_dsl.html">monty_dsl</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span>  <span class="va">sd</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span>  <span class="va">a</span> <span class="op">~</span> <span class="fu">Normal</span><span class="op">(</span><span class="va">mu</span>, <span class="va">sd</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>You can also use this to do things like:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monty_dsl.html">monty_dsl</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">a</span> <span class="op">~</span> <span class="fu">Normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">b</span> <span class="op">~</span> <span class="fu">Normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="va">b</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="va">c</span> <span class="op">~</span> <span class="fu">Normal</span><span class="op">(</span><span class="va">mu</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Where <code>c</code> is drawn from a normal distribution with a mean
that is the average of <code>a</code> and <code>b</code>.</p>
</div>
<div class="section level2">
<h2 id="pass-in-fixed-data">Pass in fixed data<a class="anchor" aria-label="anchor" href="#pass-in-fixed-data"></a>
</h2>
<p>You can also pass in a list of data with values that should be
available in the DSL code. For example, our first example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monty_dsl.html">monty_dsl</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">alpha</span> <span class="op">~</span> <span class="fu">Normal</span><span class="op">(</span><span class="fl">178</span>, <span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="va">beta</span> <span class="op">~</span> <span class="fu">Normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="va">sigma</span> <span class="op">~</span> <span class="fu">Uniform</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Might be written as</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha_mean <span class="op">=</span> <span class="fl">170</span>, alpha_sd <span class="op">=</span> <span class="fl">20</span>,</span>
<span>              beta_mean <span class="op">=</span> <span class="fl">0</span>, beta_sd <span class="op">=</span> <span class="fl">10</span>,</span>
<span>              sigma_max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monty_dsl.html">monty_dsl</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">alpha</span> <span class="op">~</span> <span class="fu">Normal</span><span class="op">(</span><span class="va">alpha_mean</span>, <span class="va">alpha_sd</span><span class="op">)</span></span>
<span>  <span class="va">beta</span> <span class="op">~</span> <span class="fu">Normal</span><span class="op">(</span><span class="va">beta_mean</span>, <span class="va">beta_sd</span><span class="op">)</span></span>
<span>  <span class="va">sigma</span> <span class="op">~</span> <span class="fu">Uniform</span><span class="op">(</span><span class="fl">0</span>, <span class="va">sigma_max</span><span class="op">)</span></span>
<span><span class="op">}</span>, fixed <span class="op">=</span> <span class="va">fixed</span><span class="op">)</span></span></code></pre></div>
<p>Values you pass in this way are <strong>fixed</strong> (hence the
name!) and cannot be modified after the model object is created.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Ed Knock, Marc Baguelin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
