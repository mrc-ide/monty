<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create basic model — mcstate_model • mcstate2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create basic model — mcstate_model"><meta name="description" content="Create a basic mcstate model.  This takes a user-supplied object
that minimally can compute a probability density (via a density
function) and information about parameters; with this we can
sample from the model using MCMC using mcstate_sample.  We
don't imagine that many users will call this function directly,
but that this will be glue used by packages."><meta property="og:description" content="Create a basic mcstate model.  This takes a user-supplied object
that minimally can compute a probability density (via a density
function) and information about parameters; with this we can
sample from the model using MCMC using mcstate_sample.  We
don't imagine that many users will call this function directly,
but that this will be glue used by packages."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mcstate2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/mcstate2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/dsl-errors.html">DSL parse errors</a></li>
    <li><a class="dropdown-item" href="../articles/dsl.html">Probabilistic DSL</a></li>
    <li><a class="dropdown-item" href="../articles/samplers.html">Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/samples.html">Working with samples</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/mcstate2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create basic model</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/mcstate2/blob/main/R/model.R" class="external-link"><code>R/model.R</code></a></small>
      <div class="d-none name"><code>mcstate_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a basic <code>mcstate</code> model.  This takes a user-supplied object
that minimally can compute a probability density (via a <code>density</code>
function) and information about parameters; with this we can
sample from the model using <code>MCMC</code> using <a href="mcstate_sample.html">mcstate_sample</a>.  We
don't imagine that many users will call this function directly,
but that this will be glue used by packages.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mcstate_model</span><span class="op">(</span><span class="va">model</span>, properties <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A list or environment with elements as described in
Details.</p></dd>


<dt id="arg-properties">properties<a class="anchor" aria-label="anchor" href="#arg-properties"></a></dt>
<dd><p>Optionally, a <a href="mcstate_model_properties.html">mcstate_model_properties</a> object,
used to enforce or clarify properties of the model.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>mcstate_model</code>.  This will have elements:</p><ul><li><p><code>model</code>: The model as provided</p></li>
<li><p><code>parameters</code>: The parameter name vector</p></li>
<li><p><code>parameter_groups</code>: The parameter groups</p></li>
<li><p><code>domain</code>: The parameter domain matrix, named with your parameters</p></li>
<li><p><code>direct_sample</code>: The <code>direct_sample</code> function, if provided by the model</p></li>
<li><p><code>gradient</code>: The <code>gradient</code> function, if provided by the model</p></li>
<li><p><code>properties</code>: A list of properties of the model;
see <code><a href="mcstate_model_properties.html">mcstate_model_properties()</a></code>.  Currently this contains:</p><ul><li><p><code>has_gradient</code>: the model can compute its gradient</p></li>
<li><p><code>has_direct_sample</code>: the model can sample from parameters space</p></li>
<li><p><code>is_stochastic</code>: the model will behave stochastically</p></li>
<li><p><code>has_parameter_groups</code>: The model has separable parameter groups</p></li>
</ul></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>model</code> argument can be a list or environment (something
indexable by <code>$</code>) and have elements:</p><ul><li><p><code>density</code>: A function that will compute some probability
density.  It must take an argument representing a parameter
vector (a numeric vector) and return a single value.  This is
the posterior probability density in Bayesian inference, but it
could be anything really.  Models can return <code>-Inf</code> if things
are impossible, and we'll try and cope gracefully with that
wherever possible.  If the property <code>allow_multiple_parameters</code>
is <code>TRUE</code>, then this function must be able to handle the
argument parameter being a matrix,  and return a vector
of densities.</p></li>
<li><p><code>parameters</code>: A character vector of parameter names.  This
vector is the source of truth for the length of the parameter
vector.</p></li>
<li><p><code>domain</code>: Information on the parameter domain.  This is a two
column matrix with <code>length(parameters)</code> rows representing each
parameter.  The parameter minimum and maximum bounds are given
as the first and second column.  Infinite values (<code>-Inf</code> or
<code>Inf</code>) should be used where the parameter has infinite domain up
or down.  Currently used to translate from a bounded to
unbounded space for HMC, but we might also use this for
reflecting proposals in MCMC too, as well as a fast way of
avoiding calculating densities where proposals fall out of
bounds.  If not present we assume that the model is valid
everywhere (i.e., that all parameters are valid from <code>-Inf</code> to
<code>Inf</code>.  If unnamed, you must provide a domain for all
parameters.  If named, then you can provide a subset, with
parameters that are not included assumed to have a domain of
<code>(-Inf, Inf)</code>.</p></li>
<li><p><code>direct_sample</code>: A function to sample directly from the
parameter space, given an <a href="mcstate_rng.html">mcstate_rng</a> object to sample from.
In the case where a model returns a posterior (e.g., in Bayesian
inference), this is assumed to be sampling from the prior.
We'll use this for generating initial conditions for MCMC where
those are not given, and possibly other uses.  If not given then
when using <code><a href="mcstate_sample.html">mcstate_sample()</a></code> the user will have to provide a
vector of initial states.</p></li>
<li><p><code>gradient</code>: A function to compute the gradient of <code>density</code> with
respect to the parameter vector; takes a parameter vector and
returns a vector the same length.  For efficiency, the model may
want to be stateful so that gradients can be efficiently
calculated after a density calculation, or density after
gradient, where these are called with the same parameters.  This
function is optional (and may not be well defined or possible to
define).</p></li>
<li><p><code>set_rng_state</code>: A function to set the state (this is in
contrast to the <code>rng</code> that is passed through to <code>direct_sample</code>
as that is the <em>sampler's</em> rng stream, but we assume models will
look after their own stream, and that they may need many
streams).  Models that provide this method are assumed to be
stochastic; however, you can use the <code>is_stochastic</code> property
(via <code><a href="mcstate_model_properties.html">mcstate_model_properties()</a></code>) to override this (e.g., to
run a stochastic model with its deterministic expectation).
This function takes a raw vector of random number state from
<a href="mcstate_rng.html">mcstate_rng</a> and uses it to set the random number state for
your model; this is derived from the random number stream for a
particular chain, jumped ahead.</p></li>
<li><p><code>get_rng_state</code>: A function to get the RNG state; must be
provided if <code>set_rng_state</code> is present.  Must return the random
number state, which is a raw vector (potentially quite long).</p></li>
<li><p><code>parameter_groups</code>: Optionally, an integer vector indicating
parameter group membership.  The format here may change
(especially if we explore more complex nestings) but at present
parameters with group 0 affect everything (so are accepted or
rejected as a whole), while parameters in groups 1 to <code>n</code> are
indepenent (for example, changing the parameters in group 2 does
not affect the density of parameters proposed in group 3).</p></li>
</ul></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

