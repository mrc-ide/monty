<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Parallel Tempering Sampler — monty_sampler_parallel_tempering • monty</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Parallel Tempering Sampler — monty_sampler_parallel_tempering"><meta name="description" content='Create a "parallel tempering" sampler, which runs multiple chains
at once to try and improve mixing, or takes advantage of
vectorisation/parallelisation if your underlying model supports
it.  We have tested the implementation with the random walk
sampler (monty_sampler_random_walk) but this may work with other
samplers.'><meta property="og:description" content='Create a "parallel tempering" sampler, which runs multiple chains
at once to try and improve mixing, or takes advantage of
vectorisation/parallelisation if your underlying model supports
it.  We have tested the implementation with the random walk
sampler (monty_sampler_random_walk) but this may work with other
samplers.'><meta property="og:image" content="https://mrc-ide.github.io/monty/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">monty</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/monty.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/dsl.html">Probabilistic DSL</a></li>
    <li><a class="dropdown-item" href="../articles/samples.html">Working with samples</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/dsl-errors.html">DSL parse errors</a></li>
    <li><a class="dropdown-item" href="../articles/samplers.html">Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from mcstate</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending</h6></li>
    <li><a class="dropdown-item" href="../articles/writing-samplers.html">Writing samplers</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/monty/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Parallel Tempering Sampler</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/monty/blob/main/R/sampler-parallel-tempering.R" class="external-link"><code>R/sampler-parallel-tempering.R</code></a></small>
      <div class="d-none name"><code>monty_sampler_parallel_tempering.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a "parallel tempering" sampler, which runs multiple chains
at once to try and improve mixing, or takes advantage of
vectorisation/parallelisation if your underlying model supports
it.  We have tested the implementation with the random walk
sampler (<a href="monty_sampler_random_walk.html">monty_sampler_random_walk</a>) but this may work with other
samplers.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">monty_sampler_parallel_tempering</span><span class="op">(</span></span>
<span>  <span class="va">sampler</span>,</span>
<span>  n_rungs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  beta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  base <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sampler">sampler<a class="anchor" aria-label="anchor" href="#arg-sampler"></a></dt>
<dd><p>A sampler to use for the underlying chains.  You
might use something like <code>monty_sampler_random_walk(vcv)</code> for a
random walk sampler embedded in this parallel tempering scheme.</p></dd>


<dt id="arg-n-rungs">n_rungs<a class="anchor" aria-label="anchor" href="#arg-n-rungs"></a></dt>
<dd><p>The number of <strong>extra</strong> chains to run, must be at
least 1.  We will run a total of <code>n_rungs + 1</code> chains, with one
of these being your target distribution and one being a direct
sample from your base model (often your prior).</p></dd>


<dt id="arg-beta">beta<a class="anchor" aria-label="anchor" href="#arg-beta"></a></dt>
<dd><p>A vector of beta values.  If provided, then <code>n_rungs</code>
should not be provided, and <code>beta</code> should be a vector of at
least length 2, where the first value is 1, the last value is 0
and the values in between form a strictly decreasing sequence
(i.e., no increases, no ties).</p></dd>


<dt id="arg-base">base<a class="anchor" aria-label="anchor" href="#arg-base"></a></dt>
<dd><p>An optional base model, which must be provided if your
model cannot be automatically decomposed into <code>prior + posterior</code> using <a href="monty_model_split.html">monty_model_split</a>, or if you are not using
this within a Bayesian context and you want to use an
alternative easy-to-sample-from reference distribution.  We
require that this model can be directly sampled from, that it
accepts multiple parameters (as a matrix), that it is
deterministic and we assume that it is cheap to compute
(relative to the target).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>monty_sampler</code> object, which can be used with
<a href="monty_sample.html">monty_sample</a></p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>We implement the sampler based on <a href="https://doi.org/10.1111/rssb.12464" class="external-link">https://doi.org/10.1111/rssb.12464</a></p>
    </div>
    <div class="section level2">
    <h2 id="efficiency-of-the-sampler">Efficiency of the sampler<a class="anchor" aria-label="anchor" href="#efficiency-of-the-sampler"></a></h2>
    <p>A parallel tempering sampler runs a series of chains at the same
time, so is doing much more work than a simpler sampler.  If you
run with <code>n_rungs = 10</code> you are doing 11x more work than the
underlying base sampler, so you want to make sure that this is
paid back somewhere.  There are a few places where this efficiency
may come from:</p><ol><li><p><strong>Your model is parallelisable</strong>.  If your underlying model can
run very efficiently in parallel then it may not take much longer
in "wall time" to run the extra copies of the calculations.  In
this case, you'll still be using much more CPU time but will be
able to take advantage of extra cores to get more effective
sampling if the parallel tempering sampler mixes better than the
underlying sampler.</p></li>
<li><p><strong>Your model is vectorised</strong>.  If your model is implemented in
R and vectorises the density calculations then it will generally
not take much longer to compute many densities at once than a
single one.</p></li>
<li><p><strong>Your density is multimodal</strong>.  If your density has distinct
peaks, then most samplers will struggle to explore it well, and
even with a non-parallelised, non-vectorised sampler the parallel
tempering sampler will explore the space more efficiently.  In the
limit, a normal sampler may only explore a single peak in a model
with many such peaks and will never mix properly.</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="tuning-the-beta-values">Tuning the beta values<a class="anchor" aria-label="anchor" href="#tuning-the-beta-values"></a></h2>
    <p>The argument <code>beta</code> controls the spacing of temperature among
chains.  Ideally, this is set so that adjacent chains all have the
same probability of swapping, which generally means that the
<code>beta</code> values themselves will <em>not</em> be equidistant.  Creating the
appropriate vector of betas (or "annealing schedule") requires
running a pilot run, then computing new <code>beta</code> values, then
running another (new) chain with the new beta values, repeating
this iteration a few times until the beta values stabilise.
Rumour has it, this should only take a few iterations.</p>
<p>The updated values of <code>beta</code> are stored in the <code>details</code> of your
samples after running.  So if you have a set of samples called
<code>s</code>, then <code>s$details$beta</code> will contain new beta values that you
can use on the next run.</p>
<p>It is important not to concatenate chains that are computed with
different <code>beta</code> values as they will not generally represent
samples from the target distribution (as an extreme case, consider
one set of beta values where we never accept swaps onto the target
distribution and another where we always do; we obviously cannot
concatenate these).  Therefore, every time that you change beta
values you should start a new chain.  You can do this with
<a href="monty_sample_continue.html">monty_sample_continue</a> so long as you pass <code>append = FALSE</code>.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Ed Knock, Marc Baguelin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

