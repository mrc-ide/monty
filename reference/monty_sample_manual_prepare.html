<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Prepare to sample with manual scheduling — monty_sample_manual_prepare • monty</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Prepare to sample with manual scheduling — monty_sample_manual_prepare"><meta name="description" content="Run an MCMC, but schedule execution of the chains yourself.  Use
this if you want to distribute chains over (say) the nodes of an
HPC system.  The arguments are the same as for monty_sample,
except that the runner argument is missing as you will be
looking after that yourself.  After using this function, you will
generally be wanting to run monty_sample_manual_run and
monty_sample_manual_collect."><meta property="og:description" content="Run an MCMC, but schedule execution of the chains yourself.  Use
this if you want to distribute chains over (say) the nodes of an
HPC system.  The arguments are the same as for monty_sample,
except that the runner argument is missing as you will be
looking after that yourself.  After using this function, you will
generally be wanting to run monty_sample_manual_run and
monty_sample_manual_collect."><meta property="og:image" content="https://mrc-ide.github.io/monty/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">monty</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/monty.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/dsl.html">Probabilistic DSL</a></li>
    <li><a class="dropdown-item" href="../articles/samples.html">Working with samples</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/dsl-errors.html">DSL parse errors</a></li>
    <li><a class="dropdown-item" href="../articles/samplers.html">Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from mcstate</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending</h6></li>
    <li><a class="dropdown-item" href="../articles/writing-samplers.html">Writing samplers</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/monty/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Prepare to sample with manual scheduling</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/monty/blob/main/R/sample-manual.R" class="external-link"><code>R/sample-manual.R</code></a></small>
      <div class="d-none name"><code>monty_sample_manual_prepare.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Run an MCMC, but schedule execution of the chains yourself.  Use
this if you want to distribute chains over (say) the nodes of an
HPC system.  The arguments are the same as for <a href="monty_sample.html">monty_sample</a>,
except that the <code>runner</code> argument is missing as you will be
looking after that yourself.  After using this function, you will
generally be wanting to run <a href="monty_sample_manual_run.html">monty_sample_manual_run</a> and
<a href="monty_sample_manual_collect.html">monty_sample_manual_collect</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">monty_sample_manual_prepare</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">sampler</span>,</span>
<span>  <span class="va">n_steps</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  initial <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_chains <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  burnin <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  thinning_factor <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>The model to sample from; this should be a
<code>monty_model</code> for now, but we might change this in future to
test to see if things match an interface rather than a
particular class attribute.</p></dd>


<dt id="arg-sampler">sampler<a class="anchor" aria-label="anchor" href="#arg-sampler"></a></dt>
<dd><p>A sampler to use.  These will be described later,
but we hope to make these reasonably easy to implement so that
we can try out different sampling ideas.  For now, the only
sampler implemented is <code><a href="monty_sampler_random_walk.html">monty_sampler_random_walk()</a></code>.</p></dd>


<dt id="arg-n-steps">n_steps<a class="anchor" aria-label="anchor" href="#arg-n-steps"></a></dt>
<dd><p>The number of steps to run the sampler for.</p></dd>


<dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>The path to write inputs and outputs to.  This should
be a path to a directory which does not yet exist, or which is
empty; we will create one here.  The contents of this directory
are managed by <code>monty</code> and the names and contents of files here
are an implementation detail and should not be relied on.
Calling <code><a href="monty_sample_manual_cleanup.html">monty_sample_manual_cleanup()</a></code> will delete the
directory in its entirety.  Be aware that if you use
<code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile()</a></code> here (which can be a reasonable choice!) that this
path will be deleted when your R process ends, so if using these
the process calling <code>monty_sample_manual_prepare</code> should outlive
running all sampling.</p></dd>


<dt id="arg-initial">initial<a class="anchor" aria-label="anchor" href="#arg-initial"></a></dt>
<dd><p>Optionally, initial parameter values for the
sampling.  If not given, we sample from the model (or its
prior).  Alternatively, you can provide a <code>monty_samples</code>
object here – the result of a previous call to this function –
and we will sample some starting points from the final portion
of the chains (the exact details here are subject to change, but
we'll sample from the last 20 points or 5% of the chain, which
ever smaller, with replacement, pooled across all chains in the
previous sample).</p></dd>


<dt id="arg-n-chains">n_chains<a class="anchor" aria-label="anchor" href="#arg-n-chains"></a></dt>
<dd><p>Number of chains to run.  The default is to run a
single chain, but you will likely want to run more.</p></dd>


<dt id="arg-burnin">burnin<a class="anchor" aria-label="anchor" href="#arg-burnin"></a></dt>
<dd><p>Number of steps to discard as burnin.  This affects
only the recording of steps as your chains run; we don't record
the first <code>burnin</code> steps.  Generally you would want to do this
in post-processing with <code><a href="monty_samples_thin.html">monty_samples_thin()</a></code> as this data is
discarded with no chance of getting it back.  However, if your
observation process creates a large amount of data, then you may
prefer to apply a burnin here to reduce how much memory is used.</p></dd>


<dt id="arg-thinning-factor">thinning_factor<a class="anchor" aria-label="anchor" href="#arg-thinning-factor"></a></dt>
<dd><p>A thinning factor to apply while the chain
is running.  If given, then we save every <code>thinning_factor</code>'th
step.  So if <code>thinning_factor = 2</code> we save every second step,
and if 10, we'd save every 10th.  Like <code>burnin</code> above, it is
preferable to apply this in post processing with
<code><a href="monty_samples_thin.html">monty_samples_thin()</a></code>.  However, for slow-mixing chains that
have a large observer output you can use this to reduce the
memory usage.  Use of <code>thinning_factor</code> requires that <code>n_steps</code>
is an even multiple of <code>thinning_factor</code>; so if
<code>thinning_factor</code> is 10, then <code>n_steps</code> must be a multiple of
10.  This ensures that the last step is in the sample.  The
thinning factor cannot be changed when continuing a chain.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Invisibly, the path used to store files (the same as the
value of the <code>path</code> argument)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In contrast to <a href="monty_sample.html">monty_sample</a> there is no <code>runner</code> argument
here, because by using this function directly you are taking
responsibility for being your own runner.</p>
<p>As with the ways of running a set of chains in monty, it is
expected that using <code>monty_sample_manual_*</code> will result in the
same samples being generated as if you had used <code>monty_sample</code>
with a runner of your choice.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="monty_sample_manual_run.html">monty_sample_manual_run</a> to run the chains and
<a href="monty_sample_manual_collect.html">monty_sample_manual_collect</a> / <a href="monty_sample_manual_cleanup.html">monty_sample_manual_cleanup</a> to
collect results and clean up.  <a href="monty_sample_manual_info.html">monty_sample_manual_info</a> can
print human-readable information about the state of a manual
run.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="monty_example.html">monty_example</a></span><span class="op">(</span><span class="st">"banana"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sampler</span> <span class="op">&lt;-</span> <span class="fu"><a href="monty_sampler_random_walk.html">monty_sampler_random_walk</a></span><span class="op">(</span>vcv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">monty_sample_manual_prepare</span><span class="op">(</span><span class="va">model</span>, <span class="va">sampler</span>, <span class="fl">100</span>, <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="monty_sample_manual_info.html">monty_sample_manual_info</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Manual monty sampling at </span><span style="color: #0000BB; font-weight: bold;">/tmp/Rtmpym8Z0B/file1dec6e476fdb</span> <span style="color: #00BBBB;">───────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Created 2025-10-01 07:20:25</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> 100 steps x 1 chains</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BB0000;">✖</span> No chains complete</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run the (single) chain</span></span></span>
<span class="r-in"><span><span class="fu"><a href="monty_sample_manual_run.html">monty_sample_manual_run</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="monty_sample_manual_info.html">monty_sample_manual_info</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Manual monty sampling at </span><span style="color: #0000BB; font-weight: bold;">/tmp/Rtmpym8Z0B/file1dec6e476fdb</span> <span style="color: #00BBBB;">───────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Created 2025-10-01 07:20:25</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> 100 steps x 1 chains</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> All chains complete</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Collect the results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="monty_sample_manual_collect.html">monty_sample_manual_collect</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">&lt;monty_samples: 2 parameters x 100 samples x 1 chain&gt;</span> <span style="color: #00BBBB;">───────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Parameters: 'alpha' and 'beta'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Conversion to other types is possible:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → <span style="color: #00BB00;">✔</span> posterior::as_draws_array() <span style="color: #555555;">[package loaded]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → <span style="color: #00BB00;">✔</span> posterior::as_draws_df() <span style="color: #555555;">[package loaded]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → <span style="color: #00BB00;">✔</span> coda::as.mcmc.list() <span style="color: #555555;">[package loaded]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> See `?monty_sample()` and `vignette("samples")` for more information</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Clean up samples</span></span></span>
<span class="r-in"><span><span class="fu"><a href="monty_sample_manual_cleanup.html">monty_sample_manual_cleanup</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Ed Knock, Marc Baguelin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

