<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Sample from a model — monty_sample • monty</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Sample from a model — monty_sample"><meta name="description" content="Sample from a model.  Uses a Monte Carlo method (or possibly
something else in future) to generate samples from your
distribution.  This is going to change a lot in future, as we add
support for distributing over workers, and for things like
parallel reproducible streams of random numbers.  For now it just
runs a single chain as a proof of concept."><meta property="og:description" content="Sample from a model.  Uses a Monte Carlo method (or possibly
something else in future) to generate samples from your
distribution.  This is going to change a lot in future, as we add
support for distributing over workers, and for things like
parallel reproducible streams of random numbers.  For now it just
runs a single chain as a proof of concept."><meta property="og:image" content="https://mrc-ide.github.io/monty/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">monty</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/monty.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/dsl.html">Probabilistic DSL</a></li>
    <li><a class="dropdown-item" href="../articles/samples.html">Working with samples</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/dsl-errors.html">DSL parse errors</a></li>
    <li><a class="dropdown-item" href="../articles/samplers.html">Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from mcstate</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending</h6></li>
    <li><a class="dropdown-item" href="../articles/writing-samplers.html">Writing samplers</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/monty/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Sample from a model</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/monty/blob/main/R/sample.R" class="external-link"><code>R/sample.R</code></a></small>
      <div class="d-none name"><code>monty_sample.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Sample from a model.  Uses a Monte Carlo method (or possibly
something else in future) to generate samples from your
distribution.  This is going to change a lot in future, as we add
support for distributing over workers, and for things like
parallel reproducible streams of random numbers.  For now it just
runs a single chain as a proof of concept.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">monty_sample</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">sampler</span>,</span>
<span>  <span class="va">n_steps</span>,</span>
<span>  initial <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_chains <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  runner <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  restartable <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  burnin <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  thinning_factor <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>The model to sample from; this should be a
<code>monty_model</code> for now, but we might change this in future to
test to see if things match an interface rather than a
particular class attribute.</p></dd>


<dt id="arg-sampler">sampler<a class="anchor" aria-label="anchor" href="#arg-sampler"></a></dt>
<dd><p>A sampler to use.  These will be described later,
but we hope to make these reasonably easy to implement so that
we can try out different sampling ideas.  For now, the only
sampler implemented is <code><a href="monty_sampler_random_walk.html">monty_sampler_random_walk()</a></code>.</p></dd>


<dt id="arg-n-steps">n_steps<a class="anchor" aria-label="anchor" href="#arg-n-steps"></a></dt>
<dd><p>The number of steps to run the sampler for.</p></dd>


<dt id="arg-initial">initial<a class="anchor" aria-label="anchor" href="#arg-initial"></a></dt>
<dd><p>Optionally, initial parameter values for the
sampling.  If not given, we sample from the model (or its
prior).  Alternatively, you can provide a <code>monty_samples</code>
object here – the result of a previous call to this function –
and we will sample some starting points from the final portion
of the chains (the exact details here are subject to change, but
we'll sample from the last 20 points or 5% of the chain, which
ever smaller, with replacement, pooled across all chains in the
previous sample).</p></dd>


<dt id="arg-n-chains">n_chains<a class="anchor" aria-label="anchor" href="#arg-n-chains"></a></dt>
<dd><p>Number of chains to run.  The default is to run a
single chain, but you will likely want to run more.</p></dd>


<dt id="arg-runner">runner<a class="anchor" aria-label="anchor" href="#arg-runner"></a></dt>
<dd><p>A runner for your chains.  The default option is to
run chains in series (via <a href="monty_runner_serial.html">monty_runner_serial</a>).  The only
other current option is <a href="monty_runner_parallel.html">monty_runner_parallel</a> which uses the
<code>parallel</code> package to run chains in parallel.  If you only run
one chain then this argument is best left alone.</p></dd>


<dt id="arg-restartable">restartable<a class="anchor" aria-label="anchor" href="#arg-restartable"></a></dt>
<dd><p>Logical, indicating if the chains should be
restartable.  This will add additional data to the chains
object.</p></dd>


<dt id="arg-burnin">burnin<a class="anchor" aria-label="anchor" href="#arg-burnin"></a></dt>
<dd><p>Number of steps to discard as burnin.  This affects
only the recording of steps as your chains run; we don't record
the first <code>burnin</code> steps.  Generally you would want to do this
in post-processing with <code><a href="monty_samples_thin.html">monty_samples_thin()</a></code> as this data is
discarded with no chance of getting it back.  However, if your
observation process creates a large amount of data, then you may
prefer to apply a burnin here to reduce how much memory is used.</p></dd>


<dt id="arg-thinning-factor">thinning_factor<a class="anchor" aria-label="anchor" href="#arg-thinning-factor"></a></dt>
<dd><p>A thinning factor to apply while the chain
is running.  If given, then we save every <code>thinning_factor</code>'th
step.  So if <code>thinning_factor = 2</code> we save every second step,
and if 10, we'd save every 10th.  Like <code>burnin</code> above, it is
preferable to apply this in post processing with
<code><a href="monty_samples_thin.html">monty_samples_thin()</a></code>.  However, for slow-mixing chains that
have a large observer output you can use this to reduce the
memory usage.  Use of <code>thinning_factor</code> requires that <code>n_steps</code>
is an even multiple of <code>thinning_factor</code>; so if
<code>thinning_factor</code> is 10, then <code>n_steps</code> must be a multiple of
10.  This ensures that the last step is in the sample.  The
thinning factor cannot be changed when continuing a chain.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of parameters and densities.  We provide conversion
to formats used by other packages, notably
<a href="https://mc-stan.org/posterior/reference/draws_array.html" class="external-link">posterior::as_draws_array</a>, <a href="https://mc-stan.org/posterior/reference/draws_df.html" class="external-link">posterior::as_draws_df</a> and
<a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">coda::as.mcmc.list</a>; please let us know if you need conversion
to something else.  If you want to work directly with the
output, the elements in the list include:</p><ul><li><p><code>pars</code>: An array with three dimensions representing (in turn)
parameter, sample and chain, so that <code>pars[i, j, k]</code> is the
<code>i</code>th parameter from the <code>j</code>th sample from the <code>k</code>th chain.  The
rows will be named with the names of the parameters, from your
model.</p></li>
<li><p><code>density</code>: A matrix of model log densities, with <code>n_steps</code> rows
and <code>n_chains</code> columns.</p></li>
<li><p><code>initial</code>: A record of the initial conditions, a matrix with as
many rows as you have parameters and <code>n_chains</code> columns (this is
the same format as the matrix form of the <code>initial</code> input
parameter)</p></li>
<li><p><code>details</code>: Additional details reported by the sampler; this will
be a list of length <code>n_chains</code> (or <code>NULL</code>) and the details
depend on the sampler.  This one is subject to change.</p></li>
<li><p><code>observations</code>: Additional details reported by the model.  This
one is also subject to change.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="monty_example.html">monty_example</a></span><span class="op">(</span><span class="st">"banana"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="monty_sampler_hmc.html">monty_sampler_hmc</a></span><span class="op">(</span>epsilon <span class="op">=</span> <span class="fl">0.1</span>, n_integration_steps <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu">monty_sample</span><span class="op">(</span><span class="va">m</span>, <span class="va">s</span>, <span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Quick conversion of parameters into something plottable:</span></span></span>
<span class="r-in"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">samples</span><span class="op">$</span><span class="va">pars</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pars</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.75</span>, col <span class="op">=</span> <span class="st">"#0000ff55"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="monty_sample-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If you have the posterior package you might prefer converting to</span></span></span>
<span class="r-in"><span><span class="co"># its format for performing diagnoses:</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_df.html" class="external-link">as_draws_df</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarise_draws</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 10</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   variable    mean  median    sd   mad     q5   q95  rhat ess_bulk ess_tail</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> alpha     0.934   0.604  1.37  0.931 -<span style="color: #BB0000;">0.534</span>  3.65  1.01     238.     154.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> beta     -<span style="color: #BB0000;">0.034</span><span style="color: #BB0000; text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.040</span><span style="color: #BB0000; text-decoration: underline;">4</span> 0.975 0.944 -<span style="color: #BB0000;">1.65</span>   1.61  1.03     110.     137.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># At this point you could also use the 'bayesplot' package to plot</span></span></span>
<span class="r-in"><span><span class="co"># diagnostics.</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Ed Knock, Marc Baguelin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

