<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Build a nested packer — monty_packer_grouped • monty</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Build a nested packer — monty_packer_grouped"><meta name="description" content="Build a grouped version of monty_packer() with the same basic
idea; convert between a vector representation of some group of
numbers to a named list of structured data, but with an extra
twist: this time the unstructured vector of numbers contains
values that correspond to multiple groups and some are shared
across groups while others vary between groups.  This function
does a lot of bookkeeping in a relatively short amount of code,
so you should be familiar with the ideas in monty_packer()
before continuing."><meta property="og:description" content="Build a grouped version of monty_packer() with the same basic
idea; convert between a vector representation of some group of
numbers to a named list of structured data, but with an extra
twist: this time the unstructured vector of numbers contains
values that correspond to multiple groups and some are shared
across groups while others vary between groups.  This function
does a lot of bookkeeping in a relatively short amount of code,
so you should be familiar with the ideas in monty_packer()
before continuing."><meta property="og:image" content="https://mrc-ide.github.io/monty/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">monty</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/monty.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/dsl.html">Probabilistic DSL</a></li>
    <li><a class="dropdown-item" href="../articles/samples.html">Working with samples</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/dsl-errors.html">DSL parse errors</a></li>
    <li><a class="dropdown-item" href="../articles/samplers.html">Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from mcstate</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending</h6></li>
    <li><a class="dropdown-item" href="../articles/writing-samplers.html">Writing samplers</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/monty/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Build a nested packer</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/monty/blob/main/R/packer-grouped.R" class="external-link"><code>R/packer-grouped.R</code></a></small>
      <div class="d-none name"><code>monty_packer_grouped.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Build a grouped version of <code><a href="monty_packer.html">monty_packer()</a></code> with the same basic
idea; convert between a vector representation of some group of
numbers to a named list of structured data, but with an extra
twist: this time the unstructured vector of numbers contains
values that correspond to multiple <em>groups</em> and some are shared
across groups while others vary between groups.  This function
does a lot of bookkeeping in a relatively short amount of code,
so you should be familiar with the ideas in <code><a href="monty_packer.html">monty_packer()</a></code>
before continuing.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">monty_packer_grouped</span><span class="op">(</span></span>
<span>  <span class="va">groups</span>,</span>
<span>  scalar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  array <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fixed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  process <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  shared <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-groups">groups<a class="anchor" aria-label="anchor" href="#arg-groups"></a></dt>
<dd><p>A character vector of group names.  These must not
be present within any of your <code>scalar</code> or <code>array</code> arguments.</p></dd>


<dt id="arg-scalar">scalar<a class="anchor" aria-label="anchor" href="#arg-scalar"></a></dt>
<dd><p>Names of scalars.  This is similar for listing
elements in <code>array</code> with values of 1, though elements in
<code>scalar</code> will be placed ahead of those listed in <code>array</code> within
the final parameter vector, and elements in <code>array</code> will have
generated names that include square brackets.</p></dd>


<dt id="arg-array">array<a class="anchor" aria-label="anchor" href="#arg-array"></a></dt>
<dd><p>A list, where names correspond to the names of arrays
and values correspond to their lengths.  Multiple dimensions are
allowed (so if you provide an element with two entries these
represent dimensions of a matrix).  Zero-length integer vectors
or <code>NULL</code> values are counted as scalars, which allows you to put
scalars at positions other than the front of the packing
vector. In future, you may be able to use <em>strings</em> as values
for the lengths, in which case these will be looked for within
<code>fixed</code>.</p></dd>


<dt id="arg-fixed">fixed<a class="anchor" aria-label="anchor" href="#arg-fixed"></a></dt>
<dd><p>A named list of fixed data to be inserted into the
final unpacked list; these will be added into the final list
directly.  In the parameter packer context, these typically
represent additional pieces of data that your model needs to
run, but which you are not performing inference on.</p></dd>


<dt id="arg-process">process<a class="anchor" aria-label="anchor" href="#arg-process"></a></dt>
<dd><p>An arbitrary R function that will be passed the
final assembled list <strong>for each group</strong>; it may create any
<em>additional</em> entries, which will be concatenated onto the
original list.  If you use this you should take care not to
return any values with the same names as entries listed in
<code>scalar</code>, <code>array</code> or <code>fixed</code>, as this is an error (this is so
that <code>pack()</code> is not broken).  We will likely play around with
this process in future in order to get automatic differentiation
to work.</p></dd>


<dt id="arg-shared">shared<a class="anchor" aria-label="anchor" href="#arg-shared"></a></dt>
<dd><p>Names of the elements in <code>scalar</code> and <code>array</code> that
are shared among all groups.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>monty_packer_grouped</code>, which has the
same elements as <code>monty_packer</code>, though with slightly different
effects.</p><ul><li><p><code>names</code>: a function that returns a character vector of computed
names; in the parameter packer context these are the names that
your statistical model will use.</p></li>
<li><p><code>groups</code>: A function that returns your group names (the <code>groups</code>
argument as supplied)</p></li>
<li><p><code>unpack</code>: A function for converting from an unstructured
vector into a nested list.  Each element of this list is
conceptually the same as the result of <code>unpack()</code> from
<code><a href="monty_packer.html">monty_packer()</a></code>.</p></li>
<li><p><code>pack</code>: The inverse to <code>unpack()</code> but less commonly performed.
Convert a nested list into an unstructured vector.  Quite a lot
of validation is required to make sure that the input has not
been tampered with, and errors thrown while doing this
validation may not be very interpretable.</p></li>
<li><p><code>index</code>: The nested version of the <code>index()</code> function in
<code><a href="monty_packer.html">monty_packer()</a></code>. The outer list is over groups, and the inner
list contains the position within the original unstructured
vector where this value can be found.  It is not clear to us if
this is a useful list.</p></li>
<li><p><code>subset</code>: A function that might eventually allow subsetting a
grouped packer.  Currently it just errors.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Recall from <code><a href="monty_packer.html">monty_packer()</a></code> that our original problem was to take
an unstructured vector like</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="sc">|</span> <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">4</span>  <span class="dv">5</span>  <span class="dv">6</span>  <span class="dv">7</span>  <span class="sc">|</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="er">|</span> a  b  c  d1 d2 d3 d4 <span class="sc">|</span></span></code></pre><p></p></div>
<p>and <strong>unpack it</strong> into a structured list like</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span>, c <span class="op">=</span> <span class="fl">3</span>, d <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Our aim here is to do the same but to allow some of these values (say
<code>b</code> and <code>c</code>) to be shared (constant) over groups while the others
(<code>a</code> and <code>d</code>) to vary by group.  So for groups <code>x</code> and <code>y</code> we might
try and create something like</p>
<p></p><div class="sourceCode r"><pre><code>list(
  list(x = list(a = 3, b = 1, c = 2, d = 4:7),
       y = list(a = 8, b = 1, c = 2, d = 9:12))
</code></pre><p></p></div>
<p>from a vector</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="sc">|</span> <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">4</span>  <span class="dv">5</span>  <span class="dv">6</span>  <span class="dv">7</span>  <span class="dv">8</span>  <span class="dv">9</span>  <span class="dv">10</span> <span class="dv">11</span> <span class="dv">12</span> <span class="sc">|</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="er">|</span> b  c  a  d1 d2 d3 d4 a  d1 d2 d3 d4 <span class="sc">|</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="er">|</span> xy xy x  x  x  x  x  y  y  y  y  y  <span class="sc">|</span></span></code></pre><p></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">monty_packer_grouped</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          shared <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span><span class="op">$</span><span class="fu">names</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "b"    "c"    "a&lt;x&gt;" "d&lt;x&gt;" "e&lt;x&gt;" "a&lt;y&gt;" "d&lt;y&gt;" "e&lt;y&gt;"</span>
<span class="r-in"><span><span class="va">p</span><span class="op">$</span><span class="fu">unpack</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x$a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x$b</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x$c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x$d</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x$e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y$a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y$b</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y$c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y$d</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y$e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Ed Knock, Marc Baguelin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

